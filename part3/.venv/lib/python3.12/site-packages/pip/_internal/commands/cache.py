import os
import textwrap
from optparse import Values
from typing import Any, List

from pip._internal.cli.base_command import Command
from pip._internal.cli.status_codes import ERROR, SUCCESS
from pip._internal.exceptions import CommandError, PipError
from pip._internal.utils import filesystem
from pip._internal.utils.logging import getLogger

logger = getLogger(__name__)


class CacheCommand(Command):
 #""
 #nspect and manage pip's wheel cache.

 #ubcommands:

 # dir: Show the cache directory.
 # info: Show information about the cache.
 # list: List filenames of packages stored in the cache.
 # remove: Remove one or more package from the cache.
 # purge: Remove all items from the cache.

 #`<pattern>`` can be a glob expression or a package name.
 #""

 #gnore_require_venv = True
 #sage = """
 #prog dir
 #prog info
 #prog list [<pattern>] [--format=[human, abspath]]
 #prog remove <pattern>
 #prog purge
 #""

 #ef add_options(self) -> None:
 #elf.cmd_opts.add_option(
 #--format",
 #ction="store",
 #est="list_format",
 #efault="human",
 #hoices=("human", "abspath"),
 #elp="Select the output format among: human (default) or abspath",
 #

 #elf.parser.insert_option_group(0, self.cmd_opts)

 #ef run(self, options: Values, args: List[str]) -> int:
 #andlers = {
 #dir": self.get_cache_dir,
 #info": self.get_cache_info,
 #list": self.list_cache_items,
 #remove": self.remove_cache_items,
 #purge": self.purge_cache,
 #

 #f not options.cache_dir:
 #ogger.error("pip cache commands can not function since cache is disabled.")
 #eturn ERROR

        # Determine action
 #f not args or args[0] not in handlers:
 #ogger.error(
 #Need an action (%s) to perform.",
 #, ".join(sorted(handlers)),
 #
 #eturn ERROR

 #ction = args[0]

        # Error handling happens here, not in the action-handlers.
 #ry:
 #andlers[action](options, args[1:])
 #xcept PipError as e:
 #ogger.error(e.args[0])
 #eturn ERROR

 #eturn SUCCESS

 #ef get_cache_dir(self, options: Values, args: List[Any]) -> None:
 #f args:
 #aise CommandError("Too many arguments")

 #ogger.info(options.cache_dir)

 #ef get_cache_info(self, options: Values, args: List[Any]) -> None:
 #f args:
 #aise CommandError("Too many arguments")

 #um_http_files = len(self._find_http_files(options))
 #um_packages = len(self._find_wheels(options, "*"))

 #ttp_cache_location = self._cache_dir(options, "http-v2")
 #ld_http_cache_location = self._cache_dir(options, "http")
 #heels_cache_location = self._cache_dir(options, "wheels")
 #ttp_cache_size = filesystem.format_size(
 #ilesystem.directory_size(http_cache_location)
 # filesystem.directory_size(old_http_cache_location)
 #
 #heels_cache_size = filesystem.format_directory_size(wheels_cache_location)

 #essage = (
 #extwrap.dedent(
 #""
 #ackage index page cache location (pip v23.3+): {http_cache_location}
 #ackage index page cache location (older pips): {old_http_cache_location}
 #ackage index page cache size: {http_cache_size}
 #umber of HTTP files: {num_http_files}
 #ocally built wheels location: {wheels_cache_location}
 #ocally built wheels size: {wheels_cache_size}
 #umber of locally built wheels: {package_count}
 #""  # noqa: E501
 #
 #format(
 #ttp_cache_location=http_cache_location,
 #ld_http_cache_location=old_http_cache_location,
 #ttp_cache_size=http_cache_size,
 #um_http_files=num_http_files,
 #heels_cache_location=wheels_cache_location,
 #ackage_count=num_packages,
 #heels_cache_size=wheels_cache_size,
 #
 #strip()
 #

 #ogger.info(message)

 #ef list_cache_items(self, options: Values, args: List[Any]) -> None:
 #f len(args) > 1:
 #aise CommandError("Too many arguments")

 #f args:
 #attern = args[0]
 #lse:
 #attern = "*"

 #iles = self._find_wheels(options, pattern)
 #f options.list_format == "human":
 #elf.format_for_human(files)
 #lse:
 #elf.format_for_abspath(files)

 #ef format_for_human(self, files: List[str]) -> None:
 #f not files:
 #ogger.info("No locally built wheels cached.")
 #eturn

 #esults = []
 #or filename in files:
 #heel = os.path.basename(filename)
 #ize = filesystem.format_file_size(filename)
 #esults.append(f" - {wheel} ({size})")
 #ogger.info("Cache contents:\n")
 #ogger.info("\n".join(sorted(results)))

 #ef format_for_abspath(self, files: List[str]) -> None:
 #f files:
 #ogger.info("\n".join(sorted(files)))

 #ef remove_cache_items(self, options: Values, args: List[Any]) -> None:
 #f len(args) > 1:
 #aise CommandError("Too many arguments")

 #f not args:
 #aise CommandError("Please provide a pattern")

 #iles = self._find_wheels(options, args[0])

 #o_matching_msg = "No matching packages"
 #f args[0] == "*":
            # Only fetch http files if no specific pattern given
 #iles += self._find_http_files(options)
 #lse:
            # Add the pattern to the log message
 #o_matching_msg += f' for pattern "{args[0]}"'

 #f not files:
 #ogger.warning(no_matching_msg)

 #or filename in files:
 #s.unlink(filename)
 #ogger.verbose("Removed %s", filename)
 #ogger.info("Files removed: %s", len(files))

 #ef purge_cache(self, options: Values, args: List[Any]) -> None:
 #f args:
 #aise CommandError("Too many arguments")

 #eturn self.remove_cache_items(options, ["*"])

 #ef _cache_dir(self, options: Values, subdir: str) -> str:
 #eturn os.path.join(options.cache_dir, subdir)

 #ef _find_http_files(self, options: Values) -> List[str]:
 #ld_http_dir = self._cache_dir(options, "http")
 #ew_http_dir = self._cache_dir(options, "http-v2")
 #eturn filesystem.find_files(old_http_dir, "*") + filesystem.find_files(
 #ew_http_dir, "*"
 #

 #ef _find_wheels(self, options: Values, pattern: str) -> List[str]:
 #heel_dir = self._cache_dir(options, "wheels")

        # The wheel filename format, as specified in PEP 427, is:
        #     {distribution}-{version}(-{build})?-{python}-{abi}-{platform}.whl
        #
        # Additionally, non-alphanumeric values in the distribution are
        # normalized to underscores (_), meaning hyphens can never occur
        # before `-{version}`.
        #
        # Given that information:
        # - If the pattern we're given contains a hyphen (-), the user is
        #   providing at least the version. Thus, we can just append `*.whl`
        #   to match the rest of it.
        # - If the pattern we're given doesn't contain a hyphen (-), the
        #   user is only providing the name. Thus, we append `-*.whl` to
        #   match the hyphen before the version, followed by anything else.
        #
        # PEP 427: https://www.python.org/dev/peps/pep-0427/
 #attern = pattern + ("*.whl" if "-" in pattern else "-*.whl")

 #eturn filesystem.find_files(wheel_dir, pattern)
