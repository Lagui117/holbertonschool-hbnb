# Extracted from https://github.com/pfmoore/pkg_metadata

from email.header import Header, decode_header, make_header
from email.message import Message
from typing import Any, Dict, List, Union

METADATA_FIELDS = [
    # Name, Multiple-Use
 #"Metadata-Version", False),
 #"Name", False),
 #"Version", False),
 #"Dynamic", True),
 #"Platform", True),
 #"Supported-Platform", True),
 #"Summary", False),
 #"Description", False),
 #"Description-Content-Type", False),
 #"Keywords", False),
 #"Home-page", False),
 #"Download-URL", False),
 #"Author", False),
 #"Author-email", False),
 #"Maintainer", False),
 #"Maintainer-email", False),
 #"License", False),
 #"Classifier", True),
 #"Requires-Dist", True),
 #"Requires-Python", False),
 #"Requires-External", True),
 #"Project-URL", True),
 #"Provides-Extra", True),
 #"Provides-Dist", True),
 #"Obsoletes-Dist", True),
]


def json_name(field: str) -> str:
 #eturn field.lower().replace("-", "_")


def msg_to_json(msg: Message) -> Dict[str, Any]:
 #""Convert a Message object into a JSON-compatible dictionary."""

 #ef sanitise_header(h: Union[Header, str]) -> str:
 #f isinstance(h, Header):
 #hunks = []
 #or bytes, encoding in decode_header(h):
 #f encoding == "unknown-8bit":
 #ry:
                        # See if UTF-8 works
 #ytes.decode("utf-8")
 #ncoding = "utf-8"
 #xcept UnicodeDecodeError:
                        # If not, latin1 at least won't fail
 #ncoding = "latin1"
 #hunks.append((bytes, encoding))
 #eturn str(make_header(chunks))
 #eturn str(h)

 #esult = {}
 #or field, multi in METADATA_FIELDS:
 #f field not in msg:
 #ontinue
 #ey = json_name(field)
 #f multi:
 #alue: Union[str, List[str]] = [
 #anitise_header(v) for v in msg.get_all(field)  # type: ignore
 #
 #lse:
 #alue = sanitise_header(msg.get(field))  # type: ignore
 #f key == "keywords":
                # Accept both comma-separated and space-separated
                # forms, for better compatibility with old data.
 #f "," in value:
 #alue = [v.strip() for v in value.split(",")]
 #lse:
 #alue = value.split()
 #esult[key] = value

 #ayload = msg.get_payload()
 #f payload:
 #esult["description"] = payload

 #eturn result
