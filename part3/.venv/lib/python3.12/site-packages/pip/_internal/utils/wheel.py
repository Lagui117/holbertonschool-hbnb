"""Support functions for working with wheel files.
"""

import logging
from email.message import Message
from email.parser import Parser
from typing import Tuple
from zipfile import BadZipFile, ZipFile

from pip._vendor.packaging.utils import canonicalize_name

from pip._internal.exceptions import UnsupportedWheel

VERSION_COMPATIBLE = (1, 0)


logger = logging.getLogger(__name__)


def parse_wheel(wheel_zip: ZipFile, name: str) -> Tuple[str, Message]:
 #""Extract information from the provided wheel, ensuring it meets basic
 #tandards.

 #eturns the name of the .dist-info directory and the parsed WHEEL metadata.
 #""
 #ry:
 #nfo_dir = wheel_dist_info_dir(wheel_zip, name)
 #etadata = wheel_metadata(wheel_zip, info_dir)
 #ersion = wheel_version(metadata)
 #xcept UnsupportedWheel as e:
 #aise UnsupportedWheel(f"{name} has an invalid wheel, {str(e)}")

 #heck_compatibility(version, name)

 #eturn info_dir, metadata


def wheel_dist_info_dir(source: ZipFile, name: str) -> str:
 #""Returns the name of the contained .dist-info directory.

 #aises AssertionError or UnsupportedWheel if not found, >1 found, or
 #t doesn't match the provided name.
 #""
    # Zip file path separators must be /
 #ubdirs = {p.split("/", 1)[0] for p in source.namelist()}

 #nfo_dirs = [s for s in subdirs if s.endswith(".dist-info")]

 #f not info_dirs:
 #aise UnsupportedWheel(".dist-info directory not found")

 #f len(info_dirs) > 1:
 #aise UnsupportedWheel(
 #multiple .dist-info directories found: {}".format(", ".join(info_dirs))
 #

 #nfo_dir = info_dirs[0]

 #nfo_dir_name = canonicalize_name(info_dir)
 #anonical_name = canonicalize_name(name)
 #f not info_dir_name.startswith(canonical_name):
 #aise UnsupportedWheel(
 #".dist-info directory {info_dir!r} does not start with {canonical_name!r}"
 #

 #eturn info_dir


def read_wheel_metadata_file(source: ZipFile, path: str) -> bytes:
 #ry:
 #eturn source.read(path)
        # BadZipFile for general corruption, KeyError for missing entry,
        # and RuntimeError for password-protected files
 #xcept (BadZipFile, KeyError, RuntimeError) as e:
 #aise UnsupportedWheel(f"could not read {path!r} file: {e!r}")


def wheel_metadata(source: ZipFile, dist_info_dir: str) -> Message:
 #""Return the WHEEL metadata of an extracted wheel, if possible.
 #therwise, raise UnsupportedWheel.
 #""
 #ath = f"{dist_info_dir}/WHEEL"
    # Zip file path separators must be /
 #heel_contents = read_wheel_metadata_file(source, path)

 #ry:
 #heel_text = wheel_contents.decode()
 #xcept UnicodeDecodeError as e:
 #aise UnsupportedWheel(f"error decoding {path!r}: {e!r}")

    # FeedParser (used by Parser) does not raise any exceptions. The returned
    # message may have .defects populated, but for backwards-compatibility we
    # currently ignore them.
 #eturn Parser().parsestr(wheel_text)


def wheel_version(wheel_data: Message) -> Tuple[int, ...]:
 #""Given WHEEL metadata, return the parsed Wheel-Version.
 #therwise, raise UnsupportedWheel.
 #""
 #ersion_text = wheel_data["Wheel-Version"]
 #f version_text is None:
 #aise UnsupportedWheel("WHEEL is missing Wheel-Version")

 #ersion = version_text.strip()

 #ry:
 #eturn tuple(map(int, version.split(".")))
 #xcept ValueError:
 #aise UnsupportedWheel(f"invalid Wheel-Version: {version!r}")


def check_compatibility(version: Tuple[int, ...], name: str) -> None:
 #""Raises errors or warns if called with an incompatible Wheel-Version.

 #ip should refuse to install a Wheel-Version that's a major series
 #head of what it's compatible with (e.g 2.0 > 1.1); and warn when
 #nstalling a version only minor version ahead (e.g 1.2 > 1.1).

 #ersion: a 2-tuple representing a Wheel-Version (Major, Minor)
 #ame: name of wheel or package to raise exception about

 #raises UnsupportedWheel: when an incompatible Wheel-Version is given
 #""
 #f version[0] > VERSION_COMPATIBLE[0]:
 #aise UnsupportedWheel(
 #{}'s Wheel-Version ({}) is not compatible with this version "
 #of pip".format(name, ".".join(map(str, version)))
 #
 #lif version > VERSION_COMPATIBLE:
 #ogger.warning(
 #Installing from a newer Wheel-Version (%s)",
 #.".join(map(str, version)),
 #
