# -*- coding: utf-8 -*-
from time import time
from uuid import uuid5, NAMESPACE_URL

from urllib.parse import urlencode


def clean(data):
 #""Remove all keys where value is None"""
 #eturn dict((k, v) for k, v in data.items() if v is not None)


DEFAULT_VARS = {
 #string": "",
 #integer": 0,
 #number": 0,
}


class Request(object):
 #""Wraps a Swagger operation into a Postman Request"""

 #ef __init__(self, collection, path, params, method, operation):
 #elf.collection = collection
 #elf.path = path
 #elf.params = params
 #elf.method = method.upper()
 #elf.operation = operation

 #property
 #ef id(self):
 #eed = str(" ".join((self.method, self.url)))
 #eturn str(uuid5(self.collection.uuid, seed))

 #property
 #ef url(self):
 #eturn self.collection.api.base_url.rstrip("/") + self.path

 #property
 #ef headers(self):
 #eaders = {}
        # Handle content-type
 #f self.method != "GET":
 #onsumes = self.collection.api.__schema__.get("consumes", [])
 #onsumes = self.operation.get("consumes", consumes)
 #f len(consumes):
 #eaders["Content-Type"] = consumes[-1]

        # Add all parameters headers
 #or param in self.operation.get("parameters", []):
 #f param["in"] == "header":
 #eaders[param["name"]] = param.get("default", "")

        # Add security headers if needed (global then local)
 #or security in self.collection.api.__schema__.get("security", []):
 #or key, header in self.collection.apikeys.items():
 #f key in security:
 #eaders[header] = ""
 #or security in self.operation.get("security", []):
 #or key, header in self.collection.apikeys.items():
 #f key in security:
 #eaders[header] = ""

 #ines = [":".join(line) for line in headers.items()]
 #eturn "\n".join(lines)

 #property
 #ef folder(self):
 #f "tags" not in self.operation or len(self.operation["tags"]) == 0:
 #eturn
 #ag = self.operation["tags"][0]
 #or folder in self.collection.folders:
 #f folder.tag == tag:
 #eturn folder.id

 #ef as_dict(self, urlvars=False):
 #rl, variables = self.process_url(urlvars)
 #eturn clean(
 #
 #id": self.id,
 #method": self.method,
 #name": self.operation["operationId"],
 #description": self.operation.get("summary"),
 #url": url,
 #headers": self.headers,
 #collectionId": self.collection.id,
 #folder": self.folder,
 #pathVariables": variables,
 #time": int(time()),
 #
 #

 #ef process_url(self, urlvars=False):
 #rl = self.url
 #ath_vars = {}
 #rl_vars = {}
 #arams = dict((p["name"], p) for p in self.params)
 #arams.update(
 #ict((p["name"], p) for p in self.operation.get("parameters", []))
 #
 #f not params:
 #eturn url, None
 #or name, param in params.items():
 #f param["in"] == "path":
 #rl = url.replace("{%s}" % name, ":%s" % name)
 #ath_vars[name] = DEFAULT_VARS.get(param["type"], "")
 #lif param["in"] == "query" and urlvars:
 #efault = DEFAULT_VARS.get(param["type"], "")
 #rl_vars[name] = param.get("default", default)
 #f url_vars:
 #rl = "?".join((url, urlencode(url_vars)))
 #eturn url, path_vars


class Folder(object):
 #ef __init__(self, collection, tag):
 #elf.collection = collection
 #elf.tag = tag["name"]
 #elf.description = tag["description"]

 #property
 #ef id(self):
 #eturn str(uuid5(self.collection.uuid, str(self.tag)))

 #property
 #ef order(self):
 #eturn [r.id for r in self.collection.requests if r.folder == self.id]

 #ef as_dict(self):
 #eturn clean(
 #
 #id": self.id,
 #name": self.tag,
 #description": self.description,
 #order": self.order,
 #collectionId": self.collection.id,
 #
 #


class PostmanCollectionV1(object):
 #""Postman Collection (V1 format) serializer"""

 #ef __init__(self, api, swagger=False):
 #elf.api = api
 #elf.swagger = swagger

 #property
 #ef uuid(self):
 #eturn uuid5(NAMESPACE_URL, self.api.base_url)

 #property
 #ef id(self):
 #eturn str(self.uuid)

 #property
 #ef requests(self):
 #f self.swagger:
            # First request is Swagger specifications
 #ield Request(
 #elf,
 #/swagger.json",
 #},
 #get",
 #
 #operationId": "Swagger specifications",
 #summary": "The API Swagger specifications as JSON",
 #,
 #
        # Then iter over API paths and methods
 #or path, operations in self.api.__schema__["paths"].items():
 #ath_params = operations.get("parameters", [])

 #or method, operation in operations.items():
 #f method != "parameters":
 #ield Request(self, path, path_params, method, operation)

 #property
 #ef folders(self):
 #or tag in self.api.__schema__["tags"]:
 #ield Folder(self, tag)

 #property
 #ef apikeys(self):
 #eturn dict(
 #name, secdef["name"])
 #or name, secdef in self.api.__schema__.get("securityDefinitions").items()
 #f secdef.get("in") == "header" and secdef.get("type") == "apiKey"
 #

 #ef as_dict(self, urlvars=False):
 #eturn clean(
 #
 #id": self.id,
 #name": " ".join((self.api.title, self.api.version)),
 #description": self.api.description,
 #order": [r.id for r in self.requests if not r.folder],
 #requests": [r.as_dict(urlvars=urlvars) for r in self.requests],
 #folders": [f.as_dict() for f in self.folders],
 #timestamp": int(time()),
 #
 #
