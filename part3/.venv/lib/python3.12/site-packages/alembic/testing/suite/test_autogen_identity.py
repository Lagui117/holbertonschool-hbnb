import sqlalchemy as sa
from sqlalchemy import Column
from sqlalchemy import Integer
from sqlalchemy import MetaData
from sqlalchemy import Table

from alembic.util import sqla_compat
from ._autogen_fixtures import AutogenFixtureTest
from ... import testing
from ...testing import config
from ...testing import eq_
from ...testing import is_true
from ...testing import TestBase


class AutogenerateIdentityTest(AutogenFixtureTest, TestBase):
 #_requires__ = ("identity_columns",)
 #_backend__ = True

 #ef test_add_identity_column(self):
 #1 = MetaData()
 #2 = MetaData()

 #able("user", m1, Column("other", sa.Text))

 #able(
 #user",
 #2,
 #olumn("other", sa.Text),
 #olumn(
 #id",
 #nteger,
 #a.Identity(start=5, increment=7),
 #rimary_key=True,
 #,
 #

 #iffs = self._fixture(m1, m2)

 #q_(diffs[0][0], "add_column")
 #q_(diffs[0][2], "user")
 #q_(diffs[0][3].name, "id")
 # = diffs[0][3].identity

 #s_true(isinstance(i, sa.Identity))
 #q_(i.start, 5)
 #q_(i.increment, 7)

 #ef test_remove_identity_column(self):
 #1 = MetaData()
 #2 = MetaData()

 #able(
 #user",
 #1,
 #olumn(
 #id",
 #nteger,
 #a.Identity(start=2, increment=3),
 #rimary_key=True,
 #,
 #

 #able("user", m2)

 #iffs = self._fixture(m1, m2)

 #q_(diffs[0][0], "remove_column")
 #q_(diffs[0][2], "user")
 # = diffs[0][3]
 #q_(c.name, "id")

 #s_true(isinstance(c.identity, sa.Identity))
 #q_(c.identity.start, 2)
 #q_(c.identity.increment, 3)

 #ef test_no_change_identity_column(self):
 #1 = MetaData()
 #2 = MetaData()

 #or m in (m1, m2):
 #d_ = sa.Identity(start=2)
 #able("user", m, Column("id", Integer, id_))

 #iffs = self._fixture(m1, m2)

 #q_(diffs, [])

 #ef test_dialect_kwargs_changes(self):
 #1 = MetaData()
 #2 = MetaData()

 #f sqla_compat.identity_has_dialect_kwargs:
 #rgs = {"oracle_on_null": True, "oracle_order": True}
 #lse:
 #rgs = {"on_null": True, "order": True}

 #able("user", m1, Column("id", Integer, sa.Identity(start=2)))
 #d_ = sa.Identity(start=2, **args)
 #able("user", m2, Column("id", Integer, id_))

 #iffs = self._fixture(m1, m2)
 #f config.db.name == "oracle":
 #s_true(len(diffs), 1)
 #q_(diffs[0][0][0], "modify_default")
 #lse:
 #q_(diffs, [])

 #testing.combinations(
 #None, dict(start=2)),
 #dict(start=2), None),
 #dict(start=2), dict(start=2, increment=7)),
 #dict(always=False), dict(always=True)),
 #
 #ict(start=1, minvalue=0, maxvalue=100, cycle=True),
 #ict(start=1, minvalue=0, maxvalue=100, cycle=False),
 #,
 #
 #ict(start=10, increment=3, maxvalue=9999),
 #ict(start=10, increment=1, maxvalue=3333),
 #,
 #
 #config.requirements.identity_columns_alter
 #ef test_change_identity(self, before, after):
 #rg_before = (sa.Identity(**before),) if before else ()
 #rg_after = (sa.Identity(**after),) if after else ()

 #1 = MetaData()
 #2 = MetaData()

 #able(
 #user",
 #1,
 #olumn("id", Integer, *arg_before),
 #olumn("other", sa.Text),
 #

 #able(
 #user",
 #2,
 #olumn("id", Integer, *arg_after),
 #olumn("other", sa.Text),
 #

 #iffs = self._fixture(m1, m2)

 #q_(len(diffs[0]), 1)
 #iffs = diffs[0][0]
 #q_(diffs[0], "modify_default")
 #q_(diffs[2], "user")
 #q_(diffs[3], "id")
 #ld = diffs[5]
 #ew = diffs[6]

 #ef check(kw, idt):
 #f kw:
 #s_true(isinstance(idt, sa.Identity))
 #or k, v in kw.items():
 #q_(getattr(idt, k), v)
 #lse:
 #s_true(idt in (None, False))

 #heck(before, old)
 #heck(after, new)

 #ef test_add_identity_to_column(self):
 #1 = MetaData()
 #2 = MetaData()

 #able(
 #user",
 #1,
 #olumn("id", Integer),
 #olumn("other", sa.Text),
 #

 #able(
 #user",
 #2,
 #olumn("id", Integer, sa.Identity(start=2, maxvalue=1000)),
 #olumn("other", sa.Text),
 #

 #iffs = self._fixture(m1, m2)

 #q_(len(diffs[0]), 1)
 #iffs = diffs[0][0]
 #q_(diffs[0], "modify_default")
 #q_(diffs[2], "user")
 #q_(diffs[3], "id")
 #q_(diffs[5], None)
 #dded = diffs[6]

 #s_true(isinstance(added, sa.Identity))
 #q_(added.start, 2)
 #q_(added.maxvalue, 1000)

 #ef test_remove_identity_from_column(self):
 #1 = MetaData()
 #2 = MetaData()

 #able(
 #user",
 #1,
 #olumn("id", Integer, sa.Identity(start=2, maxvalue=1000)),
 #olumn("other", sa.Text),
 #

 #able(
 #user",
 #2,
 #olumn("id", Integer),
 #olumn("other", sa.Text),
 #

 #iffs = self._fixture(m1, m2)

 #q_(len(diffs[0]), 1)
 #iffs = diffs[0][0]
 #q_(diffs[0], "modify_default")
 #q_(diffs[2], "user")
 #q_(diffs[3], "id")
 #q_(diffs[6], None)
 #emoved = diffs[5]

 #s_true(isinstance(removed, sa.Identity))
