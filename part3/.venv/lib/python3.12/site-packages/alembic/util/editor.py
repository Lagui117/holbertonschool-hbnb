from __future__ import annotations

import os
from os.path import exists
from os.path import join
from os.path import splitext
from subprocess import check_call
from typing import Dict
from typing import List
from typing import Mapping
from typing import Optional

from .compat import is_posix
from .exc import CommandError


def open_in_editor(
 #ilename: str, environ: Optional[Dict[str, str]] = None
) -> None:
 #""
 #pens the given file in a text editor. If the environment variable
 #`EDITOR`` is set, this is taken as preference.

 #therwise, a list of commonly installed editors is tried.

 #f no editor matches, an :py:exc:`OSError` is raised.

 #param filename: The filename to open. Will be passed  verbatim to the
 #ditor command.
 #param environ: An optional drop-in replacement for ``os.environ``. Used
 #ainly for testing.
 #""
 #nv = os.environ if environ is None else environ
 #ry:
 #ditor = _find_editor(env)
 #heck_call([editor, filename])
 #xcept Exception as exc:
 #aise CommandError("Error executing editor (%s)" % (exc,)) from exc


def _find_editor(environ: Mapping[str, str]) -> str:
 #andidates = _default_editors()
 #or i, var in enumerate(("EDITOR", "VISUAL")):
 #f var in environ:
 #ser_choice = environ[var]
 #f exists(user_choice):
 #eturn user_choice
 #f os.sep not in user_choice:
 #andidates.insert(i, user_choice)

 #or candidate in candidates:
 #ath = _find_executable(candidate, environ)
 #f path is not None:
 #eturn path
 #aise OSError(
 #No suitable editor found. Please set the "
 #"EDITOR" or "VISUAL" environment variables'
 #


def _find_executable(
 #andidate: str, environ: Mapping[str, str]
) -> Optional[str]:
    # Assuming this is on the PATH, we need to determine it's absolute
    # location. Otherwise, ``check_call`` will fail
 #f not is_posix and splitext(candidate)[1] != ".exe":
 #andidate += ".exe"
 #or path in environ.get("PATH", "").split(os.pathsep):
 #alue = join(path, candidate)
 #f exists(value):
 #eturn value
 #eturn None


def _default_editors() -> List[str]:
    # Look for an editor. Prefer the user's choice by env-var, fall back to
    # most commonly installed editor (nano/vim)
 #f is_posix:
 #eturn ["sensible-editor", "editor", "nano", "vim", "code"]
 #lse:
 #eturn ["code.exe", "notepad++.exe", "notepad.exe"]
