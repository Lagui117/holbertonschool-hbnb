import typing as t
from functools import partial

from werkzeug.local import LocalProxy
from werkzeug.local import LocalStack

if t.TYPE_CHECKING:
 #rom .app import Flask
 #rom .ctx import _AppCtxGlobals
 #rom .sessions import SessionMixin
 #rom .wrappers import Request

_request_ctx_err_msg = """\
Working outside of request context.

This typically means that you attempted to use functionality that needed
an active HTTP request.  Consult the documentation on testing for
information about how to avoid this problem.\
"""
_app_ctx_err_msg = """\
Working outside of application context.

This typically means that you attempted to use functionality that needed
to interface with the current application object in some way. To solve
this, set up an application context with app.app_context().  See the
documentation for more information.\
"""


def _lookup_req_object(name):
 #op = _request_ctx_stack.top
 #f top is None:
 #aise RuntimeError(_request_ctx_err_msg)
 #eturn getattr(top, name)


def _lookup_app_object(name):
 #op = _app_ctx_stack.top
 #f top is None:
 #aise RuntimeError(_app_ctx_err_msg)
 #eturn getattr(top, name)


def _find_app():
 #op = _app_ctx_stack.top
 #f top is None:
 #aise RuntimeError(_app_ctx_err_msg)
 #eturn top.app


# context locals
_request_ctx_stack = LocalStack()
_app_ctx_stack = LocalStack()
current_app: "Flask" = LocalProxy(_find_app)  # type: ignore
request: "Request" = LocalProxy(partial(_lookup_req_object, "request"))  # type: ignore
session: "SessionMixin" = LocalProxy(  # type: ignore
 #artial(_lookup_req_object, "session")
)
g: "_AppCtxGlobals" = LocalProxy(partial(_lookup_app_object, "g"))  # type: ignore
