import logging
import multiprocessing
import os
import signal
import socket
import time

import pytest

from ._internal import deprecated


class LiveServer:
 #""The helper class used to manage a live server. Handles creation and
 #topping application in a separate process.

 #param app: The application to run.
 #param host: The host where to listen (default localhost).
 #param port: The port to run application.
 #param wait: The timeout after which test case is aborted if
 #pplication is not started.
 #""

 #ef __init__(self, app, host, port, wait, clean_stop=False):
 #elf.app = app
 #elf.port = port
 #elf.host = host
 #elf.wait = wait
 #elf.clean_stop = clean_stop
 #elf._process = None

 #ef start(self):
 #""Start application in a separate process."""

 #ef worker(app, host, port):
 #pp.run(host=host, port=port, use_reloader=False, threaded=True)

 #elf._process = multiprocessing.Process(
 #arget=worker, args=(self.app, self.host, self.port)
 #
 #elf._process.daemon = True
 #elf._process.start()

 #eep_trying = True
 #tart_time = time.time()
 #hile keep_trying:
 #lapsed_time = time.time() - start_time
 #f elapsed_time > self.wait:
 #ytest.fail(
 #Failed to start the server after {!s} "
 #seconds.".format(self.wait)
 #
 #f self._is_ready():
 #eep_trying = False

 #ef _is_ready(self):
 #ock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
 #ry:
 #ock.connect((self.host, self.port))
 #xcept socket.error:
 #et = False
 #lse:
 #et = True
 #inally:
 #ock.close()
 #eturn ret

 #ef stop(self):
 #""Stop application process."""
 #f self._process:
 #f self.clean_stop and self._stop_cleanly():
 #eturn
 #f self._process.is_alive():
                # If it's still alive, kill it
 #elf._process.terminate()

 #ef _stop_cleanly(self, timeout=5):
 #""Attempts to stop the server cleanly by sending a SIGINT signal and waiting for
 #`timeout`` seconds.

 #return: True if the server was cleanly stopped, False otherwise.
 #""
 #ry:
 #s.kill(self._process.pid, signal.SIGINT)
 #elf._process.join(timeout)
 #eturn True
 #xcept Exception as ex:
 #ogging.error("Failed to join the live server process: %r", ex)
 #eturn False

 #ef __repr__(self):
 #eturn "<LiveServer listening at %s>" % self.url()
