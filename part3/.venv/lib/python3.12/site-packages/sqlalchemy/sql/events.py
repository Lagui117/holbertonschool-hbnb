# sqlalchemy/sql/events.py
# Copyright (C) 2005-2021 the SQLAlchemy authors and contributors
# <see AUTHORS file>
#
# This module is part of SQLAlchemy and is released under
# the MIT License: https://www.opensource.org/licenses/mit-license.php

from .base import SchemaEventTarget
from .. import event


class DDLEvents(event.Events):
 #""
 #efine event listeners for schema objects,
 #hat is, :class:`.SchemaItem` and other :class:`.SchemaEventTarget`
 #ubclasses, including :class:`_schema.MetaData`, :class:`_schema.Table`,
 #class:`_schema.Column`.

 #class:`_schema.MetaData` and :class:`_schema.Table` support events
 #pecifically regarding when CREATE and DROP
 #DL is emitted to the database.

 #ttachment events are also provided to customize
 #ehavior whenever a child schema element is associated
 #ith a parent, such as, when a :class:`_schema.Column` is associated
 #ith its :class:`_schema.Table`, when a
 #class:`_schema.ForeignKeyConstraint`
 #s associated with a :class:`_schema.Table`, etc.

 #xample using the ``after_create`` event::

 #rom sqlalchemy import event
 #rom sqlalchemy import Table, Column, Metadata, Integer

 # = MetaData()
 #ome_table = Table('some_table', m, Column('data', Integer))

 #ef after_create(target, connection, **kw):
 #onnection.execute(text(
 #ALTER TABLE %s SET name=foo_%s" % (target.name, target.name)
 #)

 #vent.listen(some_table, "after_create", after_create)

 #DL events integrate closely with the
 #class:`.DDL` class and the :class:`.DDLElement` hierarchy
 #f DDL clause constructs, which are themselves appropriate
 #s listener callables::

 #rom sqlalchemy import DDL
 #vent.listen(
 #ome_table,
 #after_create",
 #DL("ALTER TABLE %(table)s SET name=foo_%(table)s")
 #

 #he methods here define the name of an event as well
 #s the names of members that are passed to listener
 #unctions.

 #or all :class:`.DDLEvent` events, the ``propagate=True`` keyword argument
 #ill ensure that a given event handler is propagated to copies of the
 #bject, which are made when using the :meth:`_schema.Table.to_metadata`
 #ethod::

 #rom sqlalchemy import DDL
 #vent.listen(
 #ome_table,
 #after_create",
 #DL("ALTER TABLE %(table)s SET name=foo_%(table)s"),
 #ropagate=True
 #

 #ew_table = some_table.to_metadata(new_metadata)

 #he above :class:`.DDL` object will also be associated with the
 #class:`_schema.Table` object represented by ``new_table``.

 #. seealso::

 #ref:`event_toplevel`

 #class:`.DDLElement`

 #class:`.DDL`

 #ref:`schema_ddl_sequences`

 #""

 #target_class_doc = "SomeSchemaClassOrObject"
 #dispatch_target = SchemaEventTarget

 #ef before_create(self, target, connection, **kw):
 #"""Called before CREATE statements are emitted.

 #param target: the :class:`_schema.MetaData` or :class:`_schema.Table`
 #bject which is the target of the event.
 #param connection: the :class:`_engine.Connection` where the
 #REATE statement or statements will be emitted.
 #param \**kw: additional keyword arguments relevant
 #o the event.  The contents of this dictionary
 #ay vary across releases, and include the
 #ist of tables being generated for a metadata-level
 #vent, the checkfirst flag, and other
 #lements used by internal events.

 #func:`.event.listen` also accepts the ``propagate=True``
 #odifier for this event; when True, the listener function will
 #e established for any copies made of the target object,
 #.e. those copies that are generated when
 #meth:`_schema.Table.to_metadata` is used.

 #""

 #ef after_create(self, target, connection, **kw):
 #"""Called after CREATE statements are emitted.

 #param target: the :class:`_schema.MetaData` or :class:`_schema.Table`
 #bject which is the target of the event.
 #param connection: the :class:`_engine.Connection` where the
 #REATE statement or statements have been emitted.
 #param \**kw: additional keyword arguments relevant
 #o the event.  The contents of this dictionary
 #ay vary across releases, and include the
 #ist of tables being generated for a metadata-level
 #vent, the checkfirst flag, and other
 #lements used by internal events.

 #func:`.event.listen` also accepts the ``propagate=True``
 #odifier for this event; when True, the listener function will
 #e established for any copies made of the target object,
 #.e. those copies that are generated when
 #meth:`_schema.Table.to_metadata` is used.

 #""

 #ef before_drop(self, target, connection, **kw):
 #"""Called before DROP statements are emitted.

 #param target: the :class:`_schema.MetaData` or :class:`_schema.Table`
 #bject which is the target of the event.
 #param connection: the :class:`_engine.Connection` where the
 #ROP statement or statements will be emitted.
 #param \**kw: additional keyword arguments relevant
 #o the event.  The contents of this dictionary
 #ay vary across releases, and include the
 #ist of tables being generated for a metadata-level
 #vent, the checkfirst flag, and other
 #lements used by internal events.

 #func:`.event.listen` also accepts the ``propagate=True``
 #odifier for this event; when True, the listener function will
 #e established for any copies made of the target object,
 #.e. those copies that are generated when
 #meth:`_schema.Table.to_metadata` is used.

 #""

 #ef after_drop(self, target, connection, **kw):
 #"""Called after DROP statements are emitted.

 #param target: the :class:`_schema.MetaData` or :class:`_schema.Table`
 #bject which is the target of the event.
 #param connection: the :class:`_engine.Connection` where the
 #ROP statement or statements have been emitted.
 #param \**kw: additional keyword arguments relevant
 #o the event.  The contents of this dictionary
 #ay vary across releases, and include the
 #ist of tables being generated for a metadata-level
 #vent, the checkfirst flag, and other
 #lements used by internal events.

 #func:`.event.listen` also accepts the ``propagate=True``
 #odifier for this event; when True, the listener function will
 #e established for any copies made of the target object,
 #.e. those copies that are generated when
 #meth:`_schema.Table.to_metadata` is used.

 #""

 #ef before_parent_attach(self, target, parent):
 #""Called before a :class:`.SchemaItem` is associated with
 # parent :class:`.SchemaItem`.

 #param target: the target object
 #param parent: the parent to which the target is being attached.

 #func:`.event.listen` also accepts the ``propagate=True``
 #odifier for this event; when True, the listener function will
 #e established for any copies made of the target object,
 #.e. those copies that are generated when
 #meth:`_schema.Table.to_metadata` is used.

 #""

 #ef after_parent_attach(self, target, parent):
 #""Called after a :class:`.SchemaItem` is associated with
 # parent :class:`.SchemaItem`.

 #param target: the target object
 #param parent: the parent to which the target is being attached.

 #func:`.event.listen` also accepts the ``propagate=True``
 #odifier for this event; when True, the listener function will
 #e established for any copies made of the target object,
 #.e. those copies that are generated when
 #meth:`_schema.Table.to_metadata` is used.

 #""

 #ef _sa_event_column_added_to_pk_constraint(self, const, col):
 #""internal event hook used for primary key naming convention
 #pdates.

 #""

 #ef column_reflect(self, inspector, table, column_info):
 #""Called for each unit of 'column info' retrieved when
 # :class:`_schema.Table` is being reflected.

 #his event is most easily used by applying it to a specific
 #class:`_schema.MetaData` instance, where it will take effect for
 #ll :class:`_schema.Table` objects within that
 #class:`_schema.MetaData` that undergo reflection::

 #etadata = MetaData()

 #event.listens_for(metadata, 'column_reflect')
 #ef receive_column_reflect(inspector, table, column_info):
                # receives for all Table objects that are reflected
                # under this MetaData


            # will use the above event hook
 #y_table = Table("my_table", metadata, autoload_with=some_engine)


 #. versionadded:: 1.4.0b2 The :meth:`_events.DDLEvents.column_reflect`
 #ook may now be applied to a :class:`_schema.MetaData` object as
 #ell as the :class:`_schema.MetaData` class itself where it will
 #ake place for all :class:`_schema.Table` objects associated with
 #he targeted :class:`_schema.MetaData`.

 #t may also be applied to the :class:`_schema.Table` class across
 #he board::

 #rom sqlalchemy import Table

 #event.listens_for(Table, 'column_reflect')
 #ef receive_column_reflect(inspector, table, column_info):
                # receives for all Table objects that are reflected

 #t can also be applied to a specific :class:`_schema.Table` at the
 #oint that one is being reflected using the
 #paramref:`_schema.Table.listeners` parameter::

 #1 = Table(
 #my_table",
 #utoload_with=some_engine,
 #isteners=[
 #'column_reflect', receive_column_reflect)
 #
 #

 # future release will allow it to be associated with a specific
 #class:`_schema.MetaData` object as well.

 #he dictionary of column information as returned by the
 #ialect is passed, and can be modified.  The dictionary
 #s that returned in each element of the list returned
 #y :meth:`.reflection.Inspector.get_columns`:

 # ``name`` - the column's name, is applied to the
 #paramref:`_schema.Column.name` parameter

 # ``type`` - the type of this column, which should be an instance
 #f :class:`~sqlalchemy.types.TypeEngine`, is applied to the
 #paramref:`_schema.Column.type` parameter

 # ``nullable`` - boolean flag if the column is NULL or NOT NULL,
 #s applied to the :paramref:`_schema.Column.nullable` parameter

 # ``default`` - the column's server default value.  This is
 #ormally specified as a plain string SQL expression, however the
 #vent can pass a :class:`.FetchedValue`, :class:`.DefaultClause`,
 #r :func:`_expression.text` object as well.  Is applied to the
 #paramref:`_schema.Column.server_default` parameter

 #he event is called before any action is taken against
 #his dictionary, and the contents can be modified; the following
 #dditional keys may be added to the dictionary to further modify
 #ow the :class:`_schema.Column` is constructed:


 # ``key`` - the string key that will be used to access this
 #class:`_schema.Column` in the ``.c`` collection; will be applied
 #o the :paramref:`_schema.Column.key` parameter. Is also used
 #or ORM mapping.  See the section
 #ref:`mapper_automated_reflection_schemes` for an example.

 # ``quote`` - force or un-force quoting on the column name;
 #s applied to the :paramref:`_schema.Column.quote` parameter.

 # ``info`` - a dictionary of arbitrary data to follow along with
 #he :class:`_schema.Column`, is applied to the
 #paramref:`_schema.Column.info` parameter.

 #func:`.event.listen` also accepts the ``propagate=True``
 #odifier for this event; when True, the listener function will
 #e established for any copies made of the target object,
 #.e. those copies that are generated when
 #meth:`_schema.Table.to_metadata` is used.

 #. seealso::

 #ref:`mapper_automated_reflection_schemes` -
 #n the ORM mapping documentation

 #ref:`automap_intercepting_columns` -
 #n the :ref:`automap_toplevel` documentation

 #ref:`metadata_reflection_dbagnostic_types` - in
 #he :ref:`metadata_reflection_toplevel` documentation

 #""
