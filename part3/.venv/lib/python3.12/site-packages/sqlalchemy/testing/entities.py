# testing/entities.py
# Copyright (C) 2005-2021 the SQLAlchemy authors and contributors
# <see AUTHORS file>
#
# This module is part of SQLAlchemy and is released under
# the MIT License: https://www.opensource.org/licenses/mit-license.php

import sqlalchemy as sa
from .. import exc as sa_exc
from ..util import compat

_repr_stack = set()


class BasicEntity(object):
 #ef __init__(self, **kw):
 #or key, value in kw.items():
 #etattr(self, key, value)

 #ef __repr__(self):
 #f id(self) in _repr_stack:
 #eturn object.__repr__(self)
 #repr_stack.add(id(self))
 #ry:
 #eturn "%s(%s)" % (
 #self.__class__.__name__),
 #, ".join(
 #
 #%s=%r" % (key, getattr(self, key))
 #or key in sorted(self.__dict__.keys())
 #f not key.startswith("_")
 #
 #,
 #
 #inally:
 #repr_stack.remove(id(self))


_recursion_stack = set()


class ComparableMixin(object):
 #ef __ne__(self, other):
 #eturn not self.__eq__(other)

 #ef __eq__(self, other):
 #""'Deep, sparse compare.

 #eeply compare two entities, following the non-None attributes of the
 #on-persisted object, if possible.

 #""
 #f other is self:
 #eturn True
 #lif not self.__class__ == other.__class__:
 #eturn False

 #f id(self) in _recursion_stack:
 #eturn True
 #recursion_stack.add(id(self))

 #ry:
            # pick the entity that's not SA persisted as the source
 #ry:
 #elf_key = sa.orm.attributes.instance_state(self).key
 #xcept sa.orm.exc.NO_STATE:
 #elf_key = None

 #f other is None:
 # = self
 # = other
 #lif self_key is not None:
 # = other
 # = self
 #lse:
 # = self
 # = other

 #or attr in list(a.__dict__):
 #f attr.startswith("_"):
 #ontinue
 #alue = getattr(a, attr)

 #ry:
                    # handle lazy loader errors
 #attr = getattr(b, attr)
 #xcept (AttributeError, sa_exc.UnboundExecutionError):
 #eturn False

 #f hasattr(value, "__iter__") and not isinstance(
 #alue, compat.string_types
 #:
 #f hasattr(value, "__getitem__") and not hasattr(
 #alue, "keys"
 #:
 #f list(value) != list(battr):
 #eturn False
 #lse:
 #f set(value) != set(battr):
 #eturn False
 #lse:
 #f value is not None and value != battr:
 #eturn False
 #eturn True
 #inally:
 #recursion_stack.remove(id(self))


class ComparableEntity(ComparableMixin, BasicEntity):
 #ef __hash__(self):
 #eturn hash(self.__class__)
