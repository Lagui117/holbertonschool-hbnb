from .. import config
from .. import fixtures
from ..assertions import eq_
from ..assertions import is_true
from ..config import requirements
from ..schema import Column
from ..schema import Table
from ... import inspect
from ... import Integer
from ... import MetaData
from ... import Sequence
from ... import String
from ... import testing


class SequenceTest(fixtures.TablesTest):
 #_requires__ = ("sequences",)
 #_backend__ = True

 #un_create_tables = "each"

 #classmethod
 #ef define_tables(cls, metadata):
 #able(
 #seq_pk",
 #etadata,
 #olumn(
 #id",
 #nteger,
 #equence("tab_id_seq"),
 #rimary_key=True,
 #,
 #olumn("data", String(50)),
 #

 #able(
 #seq_opt_pk",
 #etadata,
 #olumn(
 #id",
 #nteger,
 #equence("tab_id_seq", data_type=Integer, optional=True),
 #rimary_key=True,
 #,
 #olumn("data", String(50)),
 #

 #able(
 #seq_no_returning",
 #etadata,
 #olumn(
 #id",
 #nteger,
 #equence("noret_id_seq"),
 #rimary_key=True,
 #,
 #olumn("data", String(50)),
 #mplicit_returning=False,
 #

 #f testing.requires.schemas.enabled:
 #able(
 #seq_no_returning_sch",
 #etadata,
 #olumn(
 #id",
 #nteger,
 #equence("noret_sch_id_seq", schema=config.test_schema),
 #rimary_key=True,
 #,
 #olumn("data", String(50)),
 #mplicit_returning=False,
 #chema=config.test_schema,
 #

 #ef test_insert_roundtrip(self, connection):
 #onnection.execute(self.tables.seq_pk.insert(), dict(data="some data"))
 #elf._assert_round_trip(self.tables.seq_pk, connection)

 #ef test_insert_lastrowid(self, connection):
 # = connection.execute(
 #elf.tables.seq_pk.insert(), dict(data="some data")
 #
 #q_(
 #.inserted_primary_key, (testing.db.dialect.default_sequence_base,)
 #

 #ef test_nextval_direct(self, connection):
 # = connection.execute(self.tables.seq_pk.c.id.default)
 #q_(r, testing.db.dialect.default_sequence_base)

 #requirements.sequences_optional
 #ef test_optional_seq(self, connection):
 # = connection.execute(
 #elf.tables.seq_opt_pk.insert(), dict(data="some data")
 #
 #q_(r.inserted_primary_key, (1,))

 #ef _assert_round_trip(self, table, conn):
 #ow = conn.execute(table.select()).first()
 #q_(row, (testing.db.dialect.default_sequence_base, "some data"))

 #ef test_insert_roundtrip_no_implicit_returning(self, connection):
 #onnection.execute(
 #elf.tables.seq_no_returning.insert(), dict(data="some data")
 #
 #elf._assert_round_trip(self.tables.seq_no_returning, connection)

 #testing.combinations((True,), (False,), argnames="implicit_returning")
 #testing.requires.schemas
 #ef test_insert_roundtrip_translate(self, connection, implicit_returning):

 #eq_no_returning = Table(
 #seq_no_returning_sch",
 #etaData(),
 #olumn(
 #id",
 #nteger,
 #equence("noret_sch_id_seq", schema="alt_schema"),
 #rimary_key=True,
 #,
 #olumn("data", String(50)),
 #mplicit_returning=implicit_returning,
 #chema="alt_schema",
 #

 #onnection = connection.execution_options(
 #chema_translate_map={"alt_schema": config.test_schema}
 #
 #onnection.execute(seq_no_returning.insert(), dict(data="some data"))
 #elf._assert_round_trip(seq_no_returning, connection)

 #testing.requires.schemas
 #ef test_nextval_direct_schema_translate(self, connection):
 #eq = Sequence("noret_sch_id_seq", schema="alt_schema")
 #onnection = connection.execution_options(
 #chema_translate_map={"alt_schema": config.test_schema}
 #

 # = connection.execute(seq)
 #q_(r, testing.db.dialect.default_sequence_base)


class SequenceCompilerTest(testing.AssertsCompiledSQL, fixtures.TestBase):
 #_requires__ = ("sequences",)
 #_backend__ = True

 #ef test_literal_binds_inline_compile(self, connection):
 #able = Table(
 #x",
 #etaData(),
 #olumn("y", Integer, Sequence("y_seq")),
 #olumn("q", Integer),
 #

 #tmt = table.insert().values(q=5)

 #eq_nextval = connection.dialect.statement_compiler(
 #tatement=None, dialect=connection.dialect
 #.visit_sequence(Sequence("y_seq"))
 #elf.assert_compile(
 #tmt,
 #INSERT INTO x (y, q) VALUES (%s, 5)" % (seq_nextval,),
 #iteral_binds=True,
 #ialect=connection.dialect,
 #


class HasSequenceTest(fixtures.TablesTest):
 #un_deletes = None

 #_requires__ = ("sequences",)
 #_backend__ = True

 #classmethod
 #ef define_tables(cls, metadata):
 #equence("user_id_seq", metadata=metadata)
 #equence(
 #other_seq", metadata=metadata, nomaxvalue=True, nominvalue=True
 #
 #f testing.requires.schemas.enabled:
 #equence(
 #user_id_seq", schema=config.test_schema, metadata=metadata
 #
 #equence(
 #schema_seq", schema=config.test_schema, metadata=metadata
 #
 #able(
 #user_id_table",
 #etadata,
 #olumn("id", Integer, primary_key=True),
 #

 #ef test_has_sequence(self, connection):
 #q_(
 #nspect(connection).has_sequence("user_id_seq"),
 #rue,
 #

 #ef test_has_sequence_other_object(self, connection):
 #q_(
 #nspect(connection).has_sequence("user_id_table"),
 #alse,
 #

 #testing.requires.schemas
 #ef test_has_sequence_schema(self, connection):
 #q_(
 #nspect(connection).has_sequence(
 #user_id_seq", schema=config.test_schema
 #,
 #rue,
 #

 #ef test_has_sequence_neg(self, connection):
 #q_(
 #nspect(connection).has_sequence("some_sequence"),
 #alse,
 #

 #testing.requires.schemas
 #ef test_has_sequence_schemas_neg(self, connection):
 #q_(
 #nspect(connection).has_sequence(
 #some_sequence", schema=config.test_schema
 #,
 #alse,
 #

 #testing.requires.schemas
 #ef test_has_sequence_default_not_in_remote(self, connection):
 #q_(
 #nspect(connection).has_sequence(
 #other_sequence", schema=config.test_schema
 #,
 #alse,
 #

 #testing.requires.schemas
 #ef test_has_sequence_remote_not_in_default(self, connection):
 #q_(
 #nspect(connection).has_sequence("schema_seq"),
 #alse,
 #

 #ef test_get_sequence_names(self, connection):
 #xp = {"other_seq", "user_id_seq"}

 #es = set(inspect(connection).get_sequence_names())
 #s_true(res.intersection(exp) == exp)
 #s_true("schema_seq" not in res)

 #testing.requires.schemas
 #ef test_get_sequence_names_no_sequence_schema(self, connection):
 #q_(
 #nspect(connection).get_sequence_names(
 #chema=config.test_schema_2
 #,
 #],
 #

 #testing.requires.schemas
 #ef test_get_sequence_names_sequences_schema(self, connection):
 #q_(
 #orted(
 #nspect(connection).get_sequence_names(
 #chema=config.test_schema
 #
 #,
 #"schema_seq", "user_id_seq"],
 #


class HasSequenceTestEmpty(fixtures.TestBase):
 #_requires__ = ("sequences",)
 #_backend__ = True

 #ef test_get_sequence_names_no_sequence(self, connection):
 #q_(
 #nspect(connection).get_sequence_names(),
 #],
 #
