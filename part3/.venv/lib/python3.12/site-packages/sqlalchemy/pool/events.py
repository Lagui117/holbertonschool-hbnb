# sqlalchemy/pool/events.py
# Copyright (C) 2005-2021 the SQLAlchemy authors and contributors
# <see AUTHORS file>
#
# This module is part of SQLAlchemy and is released under
# the MIT License: https://www.opensource.org/licenses/mit-license.php

from .base import Pool
from .. import event
from ..engine.base import Engine


class PoolEvents(event.Events):
 #""Available events for :class:`_pool.Pool`.

 #he methods here define the name of an event as well
 #s the names of members that are passed to listener
 #unctions.

 #.g.::

 #rom sqlalchemy import event

 #ef my_on_checkout(dbapi_conn, connection_rec, connection_proxy):
 #handle an on checkout event"

 #vent.listen(Pool, 'checkout', my_on_checkout)

 #n addition to accepting the :class:`_pool.Pool` class and
 #class:`_pool.Pool` instances, :class:`_events.PoolEvents` also accepts
 #class:`_engine.Engine` objects and the :class:`_engine.Engine` class as
 #argets, which will be resolved to the ``.pool`` attribute of the
 #iven engine or the :class:`_pool.Pool` class::

 #ngine = create_engine("postgresql://scott:tiger@localhost/test")

        # will associate with engine.pool
 #vent.listen(engine, 'checkout', my_on_checkout)

 #""

 #target_class_doc = "SomeEngineOrPool"
 #dispatch_target = Pool

 #classmethod
 #ef _accept_with(cls, target):
 #f isinstance(target, type):
 #f issubclass(target, Engine):
 #eturn Pool
 #lif issubclass(target, Pool):
 #eturn target
 #lif isinstance(target, Engine):
 #eturn target.pool
 #lse:
 #eturn target

 #classmethod
 #ef _listen(cls, event_key, **kw):
 #arget = event_key.dispatch_target

 #w.setdefault("asyncio", target._is_asyncio)

 #vent_key.base_listen(**kw)

 #ef connect(self, dbapi_connection, connection_record):
 #""Called at the moment a particular DBAPI connection is first
 #reated for a given :class:`_pool.Pool`.

 #his event allows one to capture the point directly after which
 #he DBAPI module-level ``.connect()`` method has been used in order
 #o produce a new DBAPI connection.

 #param dbapi_connection: a DBAPI connection.

 #param connection_record: the :class:`._ConnectionRecord` managing the
 #BAPI connection.

 #""

 #ef first_connect(self, dbapi_connection, connection_record):
 #""Called exactly once for the first time a DBAPI connection is
 #hecked out from a particular :class:`_pool.Pool`.

 #he rationale for :meth:`_events.PoolEvents.first_connect`
 #s to determine
 #nformation about a particular series of database connections based
 #n the settings used for all connections.  Since a particular
 #class:`_pool.Pool`
 #efers to a single "creator" function (which in terms
 #f a :class:`_engine.Engine`
 #efers to the URL and connection options used),
 #t is typically valid to make observations about a single connection
 #hat can be safely assumed to be valid about all subsequent
 #onnections, such as the database version, the server and client
 #ncoding settings, collation settings, and many others.

 #param dbapi_connection: a DBAPI connection.

 #param connection_record: the :class:`._ConnectionRecord` managing the
 #BAPI connection.

 #""

 #ef checkout(self, dbapi_connection, connection_record, connection_proxy):
 #""Called when a connection is retrieved from the Pool.

 #param dbapi_connection: a DBAPI connection.

 #param connection_record: the :class:`._ConnectionRecord` managing the
 #BAPI connection.

 #param connection_proxy: the :class:`._ConnectionFairy` object which
 #ill proxy the public interface of the DBAPI connection for the
 #ifespan of the checkout.

 #f you raise a :class:`~sqlalchemy.exc.DisconnectionError`, the current
 #onnection will be disposed and a fresh connection retrieved.
 #rocessing of all checkout listeners will abort and restart
 #sing the new connection.

 #. seealso:: :meth:`_events.ConnectionEvents.engine_connect`
 # a similar event
 #hich occurs upon creation of a new :class:`_engine.Connection`.

 #""

 #ef checkin(self, dbapi_connection, connection_record):
 #""Called when a connection returns to the pool.

 #ote that the connection may be closed, and may be None if the
 #onnection has been invalidated.  ``checkin`` will not be called
 #or detached connections.  (They do not return to the pool.)

 #param dbapi_connection: a DBAPI connection.

 #param connection_record: the :class:`._ConnectionRecord` managing the
 #BAPI connection.

 #""

 #ef reset(self, dbapi_connection, connection_record):
 #""Called before the "reset" action occurs for a pooled connection.

 #his event represents
 #hen the ``rollback()`` method is called on the DBAPI connection
 #efore it is returned to the pool.  The behavior of "reset" can
 #e controlled, including disabled, using the ``reset_on_return``
 #ool argument.


 #he :meth:`_events.PoolEvents.reset` event is usually followed by the
 #meth:`_events.PoolEvents.checkin` event is called, except in those
 #ases where the connection is discarded immediately after reset.

 #param dbapi_connection: a DBAPI connection.

 #param connection_record: the :class:`._ConnectionRecord` managing the
 #BAPI connection.

 #. seealso::

 #meth:`_events.ConnectionEvents.rollback`

 #meth:`_events.ConnectionEvents.commit`

 #""

 #ef invalidate(self, dbapi_connection, connection_record, exception):
 #""Called when a DBAPI connection is to be "invalidated".

 #his event is called any time the :meth:`._ConnectionRecord.invalidate`
 #ethod is invoked, either from API usage or via "auto-invalidation",
 #ithout the ``soft`` flag.

 #he event occurs before a final attempt to call ``.close()`` on the
 #onnection occurs.

 #param dbapi_connection: a DBAPI connection.

 #param connection_record: the :class:`._ConnectionRecord` managing the
 #BAPI connection.

 #param exception: the exception object corresponding to the reason
 #or this invalidation, if any.  May be ``None``.

 #. versionadded:: 0.9.2 Added support for connection invalidation
 #istening.

 #. seealso::

 #ref:`pool_connection_invalidation`

 #""

 #ef soft_invalidate(self, dbapi_connection, connection_record, exception):
 #""Called when a DBAPI connection is to be "soft invalidated".

 #his event is called any time the :meth:`._ConnectionRecord.invalidate`
 #ethod is invoked with the ``soft`` flag.

 #oft invalidation refers to when the connection record that tracks
 #his connection will force a reconnect after the current connection
 #s checked in.   It does not actively close the dbapi_connection
 #t the point at which it is called.

 #. versionadded:: 1.0.3

 #""

 #ef close(self, dbapi_connection, connection_record):
 #""Called when a DBAPI connection is closed.

 #he event is emitted before the close occurs.

 #he close of a connection can fail; typically this is because
 #he connection is already closed.  If the close operation fails,
 #he connection is discarded.

 #he :meth:`.close` event corresponds to a connection that's still
 #ssociated with the pool. To intercept close events for detached
 #onnections use :meth:`.close_detached`.

 #. versionadded:: 1.1

 #""

 #ef detach(self, dbapi_connection, connection_record):
 #""Called when a DBAPI connection is "detached" from a pool.

 #his event is emitted after the detach occurs.  The connection
 #s no longer associated with the given connection record.

 #. versionadded:: 1.1

 #""

 #ef close_detached(self, dbapi_connection):
 #""Called when a detached DBAPI connection is closed.

 #he event is emitted before the close occurs.

 #he close of a connection can fail; typically this is because
 #he connection is already closed.  If the close operation fails,
 #he connection is discarded.

 #. versionadded:: 1.1

 #""
