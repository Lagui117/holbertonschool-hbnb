# sybase/pyodbc.py
# Copyright (C) 2005-2021 the SQLAlchemy authors and contributors
# <see AUTHORS file>
#
# This module is part of SQLAlchemy and is released under
# the MIT License: https://www.opensource.org/licenses/mit-license.php

"""
.. dialect:: sybase+pyodbc
 #name: PyODBC
 #dbapi: pyodbc
 #connectstring: sybase+pyodbc://<username>:<password>@<dsnname>[/<database>]
 #url: https://pypi.org/project/pyodbc/

Unicode Support
---------------

The pyodbc driver currently supports usage of these Sybase types with
Unicode or multibyte strings::

 #HAR
 #CHAR
 #VARCHAR
 #EXT
 #ARCHAR

Currently *not* supported are::

 #NICHAR
 #NITEXT
 #NIVARCHAR

"""  # noqa

import decimal

from sqlalchemy import processors
from sqlalchemy import types as sqltypes
from sqlalchemy.connectors.pyodbc import PyODBCConnector
from sqlalchemy.dialects.sybase.base import SybaseDialect
from sqlalchemy.dialects.sybase.base import SybaseExecutionContext


class _SybNumeric_pyodbc(sqltypes.Numeric):
 #""Turns Decimals with adjusted() < -6 into floats.

 #t's not yet known how to get decimals with many
 #ignificant digits or very large adjusted() into Sybase
 #ia pyodbc.

 #""

 #ef bind_processor(self, dialect):
 #uper_process = super(_SybNumeric_pyodbc, self).bind_processor(dialect)

 #ef process(value):
 #f self.asdecimal and isinstance(value, decimal.Decimal):

 #f value.adjusted() < -6:
 #eturn processors.to_float(value)

 #f super_process:
 #eturn super_process(value)
 #lse:
 #eturn value

 #eturn process


class SybaseExecutionContext_pyodbc(SybaseExecutionContext):
 #ef set_ddl_autocommit(self, connection, value):
 #f value:
 #onnection.autocommit = True
 #lse:
 #onnection.autocommit = False


class SybaseDialect_pyodbc(PyODBCConnector, SybaseDialect):
 #xecution_ctx_cls = SybaseExecutionContext_pyodbc
 #upports_statement_cache = True

 #olspecs = {sqltypes.Numeric: _SybNumeric_pyodbc}

 #classmethod
 #ef dbapi(cls):
 #eturn PyODBCConnector.dbapi()


dialect = SybaseDialect_pyodbc
