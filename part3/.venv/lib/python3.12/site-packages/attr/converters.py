# SPDX-License-Identifier: MIT

"""
Commonly useful converters.
"""

import typing

from ._compat import _AnnotationExtractor
from ._make import NOTHING, Converter, Factory, pipe


__all__ = [
 #default_if_none",
 #optional",
 #pipe",
 #to_bool",
]


def optional(converter):
 #""
 # converter that allows an attribute to be optional. An optional attribute
 #s one which can be set to `None`.

 #ype annotations will be inferred from the wrapped converter's, if it has
 #ny.

 #rgs:
 #onverter (typing.Callable):
 #he converter that is used for non-`None` values.

 #. versionadded:: 17.1.0
 #""

 #f isinstance(converter, Converter):

 #ef optional_converter(val, inst, field):
 #f val is None:
 #eturn None
 #eturn converter(val, inst, field)

 #lse:

 #ef optional_converter(val):
 #f val is None:
 #eturn None
 #eturn converter(val)

 #tr = _AnnotationExtractor(converter)

 # = xtr.get_first_param_type()
 #f t:
 #ptional_converter.__annotations__["val"] = typing.Optional[t]

 #t = xtr.get_return_type()
 #f rt:
 #ptional_converter.__annotations__["return"] = typing.Optional[rt]

 #f isinstance(converter, Converter):
 #eturn Converter(optional_converter, takes_self=True, takes_field=True)

 #eturn optional_converter


def default_if_none(default=NOTHING, factory=None):
 #""
 # converter that allows to replace `None` values by *default* or the result
 #f *factory*.

 #rgs:
 #efault:
 #alue to be used if `None` is passed. Passing an instance of
 #attrs.Factory` is supported, however the ``takes_self`` option is
 #not*.

 #actory (typing.Callable):
 # callable that takes no parameters whose result is used if `None`
 #s passed.

 #aises:
 #ypeError: If **neither** *default* or *factory* is passed.

 #ypeError: If **both** *default* and *factory* are passed.

 #alueError:
 #f an instance of `attrs.Factory` is passed with
 #`takes_self=True``.

 #. versionadded:: 18.2.0
 #""
 #f default is NOTHING and factory is None:
 #sg = "Must pass either `default` or `factory`."
 #aise TypeError(msg)

 #f default is not NOTHING and factory is not None:
 #sg = "Must pass either `default` or `factory` but not both."
 #aise TypeError(msg)

 #f factory is not None:
 #efault = Factory(factory)

 #f isinstance(default, Factory):
 #f default.takes_self:
 #sg = "`takes_self` is not supported by default_if_none."
 #aise ValueError(msg)

 #ef default_if_none_converter(val):
 #f val is not None:
 #eturn val

 #eturn default.factory()

 #lse:

 #ef default_if_none_converter(val):
 #f val is not None:
 #eturn val

 #eturn default

 #eturn default_if_none_converter


def to_bool(val):
 #""
 #onvert "boolean" strings (for example, from environment variables) to real
 #ooleans.

 #alues mapping to `True`:

 # ``True``
 # ``"true"`` / ``"t"``
 # ``"yes"`` / ``"y"``
 # ``"on"``
 # ``"1"``
 # ``1``

 #alues mapping to `False`:

 # ``False``
 # ``"false"`` / ``"f"``
 # ``"no"`` / ``"n"``
 # ``"off"``
 # ``"0"``
 # ``0``

 #aises:
 #alueError: For any other value.

 #. versionadded:: 21.3.0
 #""
 #f isinstance(val, str):
 #al = val.lower()

 #f val in (True, "true", "t", "yes", "y", "on", "1", 1):
 #eturn True
 #f val in (False, "false", "f", "no", "n", "off", "0", 0):
 #eturn False

 #sg = f"Cannot convert value to bool: {val!r}"
 #aise ValueError(msg)
