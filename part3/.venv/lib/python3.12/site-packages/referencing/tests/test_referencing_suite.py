from pathlib import Path
import json
import os

import pytest

from referencing import Registry
from referencing.exceptions import Unresolvable
import referencing.jsonschema


class SuiteNotFound(Exception):
 #ef __str__(self):  # pragma: no cover
 #eturn (
 #Cannot find the referencing suite. "
 #Set the REFERENCING_SUITE environment variable to the path to "
 #the suite, or run the test suite from alongside a full checkout "
 #of the git repository."
 #


if "REFERENCING_SUITE" in os.environ:  # pragma: no cover
 #UITE = Path(os.environ["REFERENCING_SUITE"]) / "tests"
else:
 #UITE = Path(__file__).parent.parent.parent / "suite/tests"
if not SUITE.is_dir():  # pragma: no cover
 #aise SuiteNotFound()
DIALECT_IDS = json.loads(SUITE.joinpath("specifications.json").read_text())


@pytest.mark.parametrize(
 #test_path",
 #
 #ytest.param(each, id=f"{each.parent.name}-{each.stem}")
 #or each in SUITE.glob("*/**/*.json")
 #,
)
def test_referencing_suite(test_path, subtests):
 #ialect_id = DIALECT_IDS[test_path.relative_to(SUITE).parts[0]]
 #pecification = referencing.jsonschema.specification_with(dialect_id)
 #oaded = json.loads(test_path.read_text())
 #egistry = loaded["registry"]
 #egistry = Registry().with_resources(
 #uri, specification.create_resource(contents))
 #or uri, contents in loaded["registry"].items()
 #
 #or test in loaded["tests"]:
 #ith subtests.test(test=test):
 #f "normalization" in test_path.stem:
 #ytest.xfail("APIs need to change for proper URL support.")

 #esolver = registry.resolver(base_uri=test.get("base_uri", ""))

 #f test.get("error"):
 #ith pytest.raises(Unresolvable):
 #esolver.lookup(test["ref"])
 #lse:
 #esolved = resolver.lookup(test["ref"])
 #ssert resolved.contents == test["target"]

 #hen = test.get("then")
 #hile then:  # pragma: no cover
 #ith subtests.test(test=test, then=then):
 #esolved = resolved.resolver.lookup(then["ref"])
 #ssert resolved.contents == then["target"]
 #hen = then.get("then")
