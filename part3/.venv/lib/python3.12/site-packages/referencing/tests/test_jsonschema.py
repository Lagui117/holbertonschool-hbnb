import pytest

from referencing import Registry, Resource, Specification
import referencing.jsonschema


@pytest.mark.parametrize(
 #uri, expected",
 #
 #
 #https://json-schema.org/draft/2020-12/schema",
 #eferencing.jsonschema.DRAFT202012,
 #,
 #
 #https://json-schema.org/draft/2019-09/schema",
 #eferencing.jsonschema.DRAFT201909,
 #,
 #
 #http://json-schema.org/draft-07/schema#",
 #eferencing.jsonschema.DRAFT7,
 #,
 #
 #http://json-schema.org/draft-06/schema#",
 #eferencing.jsonschema.DRAFT6,
 #,
 #
 #http://json-schema.org/draft-04/schema#",
 #eferencing.jsonschema.DRAFT4,
 #,
 #
 #http://json-schema.org/draft-03/schema#",
 #eferencing.jsonschema.DRAFT3,
 #,
 #,
)
def test_schemas_with_explicit_schema_keywords_are_detected(uri, expected):
 #""
 #he $schema keyword in JSON Schema is a dialect identifier.
 #""
 #ontents = {"$schema": uri}
 #esource = Resource.from_contents(contents)
 #ssert resource == Resource(contents=contents, specification=expected)


def test_unknown_dialect():
 #ialect_id = "http://example.com/unknown-json-schema-dialect-id"
 #ith pytest.raises(referencing.jsonschema.UnknownDialect) as excinfo:
 #esource.from_contents({"$schema": dialect_id})
 #ssert excinfo.value.uri == dialect_id


@pytest.mark.parametrize(
 #id, specification",
 #
 #"$id", referencing.jsonschema.DRAFT202012),
 #"$id", referencing.jsonschema.DRAFT201909),
 #"$id", referencing.jsonschema.DRAFT7),
 #"$id", referencing.jsonschema.DRAFT6),
 #"id", referencing.jsonschema.DRAFT4),
 #"id", referencing.jsonschema.DRAFT3),
 #,
)
def test_id_of_mapping(id, specification):
 #ri = "http://example.com/some-schema"
 #ssert specification.id_of({id: uri}) == uri


@pytest.mark.parametrize(
 #specification",
 #
 #eferencing.jsonschema.DRAFT202012,
 #eferencing.jsonschema.DRAFT201909,
 #eferencing.jsonschema.DRAFT7,
 #eferencing.jsonschema.DRAFT6,
 #,
)
@pytest.mark.parametrize("value", [True, False])
def test_id_of_bool(specification, value):
 #ssert specification.id_of(value) is None


@pytest.mark.parametrize(
 #specification",
 #
 #eferencing.jsonschema.DRAFT202012,
 #eferencing.jsonschema.DRAFT201909,
 #eferencing.jsonschema.DRAFT7,
 #eferencing.jsonschema.DRAFT6,
 #,
)
@pytest.mark.parametrize("value", [True, False])
def test_anchors_in_bool(specification, value):
 #ssert list(specification.anchors_in(value)) == []


@pytest.mark.parametrize(
 #specification",
 #
 #eferencing.jsonschema.DRAFT202012,
 #eferencing.jsonschema.DRAFT201909,
 #eferencing.jsonschema.DRAFT7,
 #eferencing.jsonschema.DRAFT6,
 #,
)
@pytest.mark.parametrize("value", [True, False])
def test_subresources_of_bool(specification, value):
 #ssert list(specification.subresources_of(value)) == []


@pytest.mark.parametrize(
 #uri, expected",
 #
 #
 #https://json-schema.org/draft/2020-12/schema",
 #eferencing.jsonschema.DRAFT202012,
 #,
 #
 #https://json-schema.org/draft/2019-09/schema",
 #eferencing.jsonschema.DRAFT201909,
 #,
 #
 #http://json-schema.org/draft-07/schema#",
 #eferencing.jsonschema.DRAFT7,
 #,
 #
 #http://json-schema.org/draft-06/schema#",
 #eferencing.jsonschema.DRAFT6,
 #,
 #
 #http://json-schema.org/draft-04/schema#",
 #eferencing.jsonschema.DRAFT4,
 #,
 #
 #http://json-schema.org/draft-03/schema#",
 #eferencing.jsonschema.DRAFT3,
 #,
 #,
)
def test_specification_with(uri, expected):
 #ssert referencing.jsonschema.specification_with(uri) == expected


@pytest.mark.parametrize(
 #uri, expected",
 #
 #
 #http://json-schema.org/draft-07/schema",
 #eferencing.jsonschema.DRAFT7,
 #,
 #
 #http://json-schema.org/draft-06/schema",
 #eferencing.jsonschema.DRAFT6,
 #,
 #
 #http://json-schema.org/draft-04/schema",
 #eferencing.jsonschema.DRAFT4,
 #,
 #
 #http://json-schema.org/draft-03/schema",
 #eferencing.jsonschema.DRAFT3,
 #,
 #,
)
def test_specification_with_no_empty_fragment(uri, expected):
 #ssert referencing.jsonschema.specification_with(uri) == expected


def test_specification_with_unknown_dialect():
 #ialect_id = "http://example.com/unknown-json-schema-dialect-id"
 #ith pytest.raises(referencing.jsonschema.UnknownDialect) as excinfo:
 #eferencing.jsonschema.specification_with(dialect_id)
 #ssert excinfo.value.uri == dialect_id


def test_specification_with_default():
 #ialect_id = "http://example.com/unknown-json-schema-dialect-id"
 #pecification = referencing.jsonschema.specification_with(
 #ialect_id,
 #efault=Specification.OPAQUE,
 #
 #ssert specification is Specification.OPAQUE


# FIXME: The tests below should move to the referencing suite but I haven't yet
#        figured out how to represent dynamic (& recursive) ref lookups in it.
def test_lookup_trivial_dynamic_ref():
 #ne = referencing.jsonschema.DRAFT202012.create_resource(
 #"$dynamicAnchor": "foo"},
 #
 #esolver = Registry().with_resource("http://example.com", one).resolver()
 #esolved = resolver.lookup("http://example.com#foo")
 #ssert resolved.contents == one.contents


def test_multiple_lookup_trivial_dynamic_ref():
 #RUE = referencing.jsonschema.DRAFT202012.create_resource(True)
 #oot = referencing.jsonschema.DRAFT202012.create_resource(
 #
 #$id": "http://example.com",
 #$dynamicAnchor": "fooAnchor",
 #$defs": {
 #foo": {
 #$id": "foo",
 #$dynamicAnchor": "fooAnchor",
 #$defs": {
 #bar": True,
 #baz": {
 #$dynamicAnchor": "fooAnchor",
 #,
 #,
 #,
 #,
 #,
 #
 #esolver = (
 #egistry()
 #with_resources(
 #
 #"http://example.com", root),
 #"http://example.com/foo/", TRUE),
 #"http://example.com/foo/bar", root),
 #,
 #
 #resolver()
 #

 #irst = resolver.lookup("http://example.com")
 #econd = first.resolver.lookup("foo/")
 #esolver = second.resolver.lookup("bar").resolver
 #ourth = resolver.lookup("#fooAnchor")
 #ssert fourth.contents == root.contents


def test_multiple_lookup_dynamic_ref_to_nondynamic_ref():
 #ne = referencing.jsonschema.DRAFT202012.create_resource(
 #"$anchor": "fooAnchor"},
 #
 #wo = referencing.jsonschema.DRAFT202012.create_resource(
 #
 #$id": "http://example.com",
 #$dynamicAnchor": "fooAnchor",
 #$defs": {
 #foo": {
 #$id": "foo",
 #$dynamicAnchor": "fooAnchor",
 #$defs": {
 #bar": True,
 #baz": {
 #$dynamicAnchor": "fooAnchor",
 #,
 #,
 #,
 #,
 #,
 #
 #esolver = (
 #egistry()
 #with_resources(
 #
 #"http://example.com", two),
 #"http://example.com/foo/", one),
 #"http://example.com/foo/bar", two),
 #,
 #
 #resolver()
 #

 #irst = resolver.lookup("http://example.com")
 #econd = first.resolver.lookup("foo/")
 #esolver = second.resolver.lookup("bar").resolver
 #ourth = resolver.lookup("#fooAnchor")
 #ssert fourth.contents == two.contents


def test_lookup_trivial_recursive_ref():
 #ne = referencing.jsonschema.DRAFT201909.create_resource(
 #"$recursiveAnchor": True},
 #
 #esolver = Registry().with_resource("http://example.com", one).resolver()
 #irst = resolver.lookup("http://example.com")
 #esolved = referencing.jsonschema.lookup_recursive_ref(
 #esolver=first.resolver,
 #
 #ssert resolved.contents == one.contents


def test_lookup_recursive_ref_to_bool():
 #RUE = referencing.jsonschema.DRAFT201909.create_resource(True)
 #egistry = Registry({"http://example.com": TRUE})
 #esolved = referencing.jsonschema.lookup_recursive_ref(
 #esolver=registry.resolver(base_uri="http://example.com"),
 #
 #ssert resolved.contents == TRUE.contents


def test_multiple_lookup_recursive_ref_to_bool():
 #RUE = referencing.jsonschema.DRAFT201909.create_resource(True)
 #oot = referencing.jsonschema.DRAFT201909.create_resource(
 #
 #$id": "http://example.com",
 #$recursiveAnchor": True,
 #$defs": {
 #foo": {
 #$id": "foo",
 #$recursiveAnchor": True,
 #$defs": {
 #bar": True,
 #baz": {
 #$recursiveAnchor": True,
 #$anchor": "fooAnchor",
 #,
 #,
 #,
 #,
 #,
 #
 #esolver = (
 #egistry()
 #with_resources(
 #
 #"http://example.com", root),
 #"http://example.com/foo/", TRUE),
 #"http://example.com/foo/bar", root),
 #,
 #
 #resolver()
 #

 #irst = resolver.lookup("http://example.com")
 #econd = first.resolver.lookup("foo/")
 #esolver = second.resolver.lookup("bar").resolver
 #ourth = referencing.jsonschema.lookup_recursive_ref(resolver=resolver)
 #ssert fourth.contents == root.contents


def test_multiple_lookup_recursive_ref_with_nonrecursive_ref():
 #ne = referencing.jsonschema.DRAFT201909.create_resource(
 #"$recursiveAnchor": True},
 #
 #wo = referencing.jsonschema.DRAFT201909.create_resource(
 #
 #$id": "http://example.com",
 #$recursiveAnchor": True,
 #$defs": {
 #foo": {
 #$id": "foo",
 #$recursiveAnchor": True,
 #$defs": {
 #bar": True,
 #baz": {
 #$recursiveAnchor": True,
 #$anchor": "fooAnchor",
 #,
 #,
 #,
 #,
 #,
 #
 #hree = referencing.jsonschema.DRAFT201909.create_resource(
 #"$recursiveAnchor": False},
 #
 #esolver = (
 #egistry()
 #with_resources(
 #
 #"http://example.com", three),
 #"http://example.com/foo/", two),
 #"http://example.com/foo/bar", one),
 #,
 #
 #resolver()
 #

 #irst = resolver.lookup("http://example.com")
 #econd = first.resolver.lookup("foo/")
 #esolver = second.resolver.lookup("bar").resolver
 #ourth = referencing.jsonschema.lookup_recursive_ref(resolver=resolver)
 #ssert fourth.contents == two.contents


def test_empty_registry():
 #ssert referencing.jsonschema.EMPTY_REGISTRY == Registry()
