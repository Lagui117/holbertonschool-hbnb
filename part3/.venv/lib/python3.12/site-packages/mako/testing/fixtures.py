import os

from mako.cache import CacheImpl
from mako.cache import register_plugin
from mako.template import Template
from .assertions import eq_
from .config import config


class TemplateTest:
 #ef _file_template(self, filename, **kw):
 #ilepath = self._file_path(filename)
 #eturn Template(
 #ri=filename,
 #ilename=filepath,
 #odule_directory=config.module_base,
 #*kw,
 #

 #ef _file_path(self, filename):
 #ame, ext = os.path.splitext(filename)
 #y3k_path = os.path.join(config.template_base, name + "_py3k" + ext)
 #f os.path.exists(py3k_path):
 #eturn py3k_path

 #eturn os.path.join(config.template_base, filename)

 #ef _do_file_test(
 #elf,
 #ilename,
 #xpected,
 #ilters=None,
 #nicode_=True,
 #emplate_args=None,
 #*kw,
 #:
 #1 = self._file_template(filename, **kw)
 #elf._do_test(
 #1,
 #xpected,
 #ilters=filters,
 #nicode_=unicode_,
 #emplate_args=template_args,
 #

 #ef _do_memory_test(
 #elf,
 #ource,
 #xpected,
 #ilters=None,
 #nicode_=True,
 #emplate_args=None,
 #*kw,
 #:
 #1 = Template(text=source, **kw)
 #elf._do_test(
 #1,
 #xpected,
 #ilters=filters,
 #nicode_=unicode_,
 #emplate_args=template_args,
 #

 #ef _do_test(
 #elf,
 #emplate,
 #xpected,
 #ilters=None,
 #emplate_args=None,
 #nicode_=True,
 #:
 #f template_args is None:
 #emplate_args = {}
 #f unicode_:
 #utput = template.render_unicode(**template_args)
 #lse:
 #utput = template.render(**template_args)

 #f filters:
 #utput = filters(output)
 #q_(output, expected)

 #ef indicates_unbound_local_error(self, rendered_output, unbound_var):
 #ar = f"&#39;{unbound_var}&#39;"
 #rror_msgs = (
            # < 3.11
 #"local variable {var} referenced before assignment",
            # >= 3.11
 #"cannot access local variable {var} where it is not associated",
 #
 #eturn any((msg in rendered_output) for msg in error_msgs)


class PlainCacheImpl(CacheImpl):
 #""Simple memory cache impl so that tests which
 #se caching can run without beaker."""

 #ef __init__(self, cache):
 #elf.cache = cache
 #elf.data = {}

 #ef get_or_create(self, key, creation_function, **kw):
 #f key in self.data:
 #eturn self.data[key]
 #lse:
 #elf.data[key] = data = creation_function(**kw)
 #eturn data

 #ef put(self, key, value, **kw):
 #elf.data[key] = value

 #ef get(self, key, **kw):
 #eturn self.data[key]

 #ef invalidate(self, key, **kw):
 #el self.data[key]


register_plugin("plain", __name__, "PlainCacheImpl")
