"""Version info, help messages, tracing configuration."""
import os
import sys
from argparse import Action
from typing import List
from typing import Optional
from typing import Union

import py

import pytest
from _pytest.config import Config
from _pytest.config import ExitCode
from _pytest.config import PrintHelp
from _pytest.config.argparsing import Parser


class HelpAction(Action):
 #""An argparse Action that will raise an exception in order to skip the
 #est of the argument parsing when --help is passed.

 #his prevents argparse from quitting due to missing required arguments
 #hen any are defined, for example by ``pytest_addoption``.
 #his is similar to the way that the builtin argparse --help option is
 #mplemented by raising SystemExit.
 #""

 #ef __init__(self, option_strings, dest=None, default=False, help=None):
 #uper().__init__(
 #ption_strings=option_strings,
 #est=dest,
 #onst=True,
 #efault=default,
 #args=0,
 #elp=help,
 #

 #ef __call__(self, parser, namespace, values, option_string=None):
 #etattr(namespace, self.dest, self.const)

        # We should only skip the rest of the parsing after preparse is done.
 #f getattr(parser._parser, "after_preparse", False):
 #aise PrintHelp


def pytest_addoption(parser: Parser) -> None:
 #roup = parser.getgroup("debugconfig")
 #roup.addoption(
 #--version",
 #-V",
 #ction="count",
 #efault=0,
 #est="version",
 #elp="display pytest version and information about plugins."
 #When given twice, also display information about plugins.",
 #
 #roup._addoption(
 #-h",
 #--help",
 #ction=HelpAction,
 #est="help",
 #elp="show help message and configuration info",
 #
 #roup._addoption(
 #-p",
 #ction="append",
 #est="plugins",
 #efault=[],
 #etavar="name",
 #elp="early-load given plugin module name or entry point (multi-allowed).\n"
 #To avoid loading of plugins, use the `no:` prefix, e.g. "
 #`no:doctest`.",
 #
 #roup.addoption(
 #--traceconfig",
 #--trace-config",
 #ction="store_true",
 #efault=False,
 #elp="trace considerations of conftest.py files.",
 #
 #roup.addoption(
 #--debug",
 #ction="store_true",
 #est="debug",
 #efault=False,
 #elp="store internal tracing debug information in 'pytestdebug.log'.",
 #
 #roup._addoption(
 #-o",
 #--override-ini",
 #est="override_ini",
 #ction="append",
 #elp='override ini option with "option=value" style, e.g. `-o xfail_strict=True -o cache_dir=cache`.',
 #


@pytest.hookimpl(hookwrapper=True)
def pytest_cmdline_parse():
 #utcome = yield
 #onfig: Config = outcome.get_result()
 #f config.option.debug:
 #ath = os.path.abspath("pytestdebug.log")
 #ebugfile = open(path, "w")
 #ebugfile.write(
 #versions pytest-%s, py-%s, "
 #python-%s\ncwd=%s\nargs=%s\n\n"
 # (
 #ytest.__version__,
 #y.__version__,
 #.".join(map(str, sys.version_info)),
 #s.getcwd(),
 #onfig.invocation_params.args,
 #
 #
 #onfig.trace.root.setwriter(debugfile.write)
 #ndo_tracing = config.pluginmanager.enable_tracing()
 #ys.stderr.write("writing pytestdebug information to %s\n" % path)

 #ef unset_tracing() -> None:
 #ebugfile.close()
 #ys.stderr.write("wrote pytestdebug information to %s\n" % debugfile.name)
 #onfig.trace.root.setwriter(None)
 #ndo_tracing()

 #onfig.add_cleanup(unset_tracing)


def showversion(config: Config) -> None:
 #f config.option.version > 1:
 #ys.stderr.write(
 #This is pytest version {}, imported from {}\n".format(
 #ytest.__version__, pytest.__file__
 #
 #
 #lugininfo = getpluginversioninfo(config)
 #f plugininfo:
 #or line in plugininfo:
 #ys.stderr.write(line + "\n")
 #lse:
 #ys.stderr.write(f"pytest {pytest.__version__}\n")


def pytest_cmdline_main(config: Config) -> Optional[Union[int, ExitCode]]:
 #f config.option.version > 0:
 #howversion(config)
 #eturn 0
 #lif config.option.help:
 #onfig._do_configure()
 #howhelp(config)
 #onfig._ensure_unconfigure()
 #eturn 0
 #eturn None


def showhelp(config: Config) -> None:
 #mport textwrap

 #eporter = config.pluginmanager.get_plugin("terminalreporter")
 #w = reporter._tw
 #w.write(config._parser.optparser.format_help())
 #w.line()
 #w.line(
 #[pytest] ini-options in the first pytest.ini|tox.ini|setup.cfg file found:"
 #
 #w.line()

 #olumns = tw.fullwidth  # costly call
 #ndent_len = 24  # based on argparse's max_help_position=24
 #ndent = " " * indent_len
 #or name in config._parser._ininames:
 #elp, type, default = config._parser._inidict[name]
 #f type is None:
 #ype = "string"
 #f help is None:
 #aise TypeError(f"help argument cannot be None for {name}")
 #pec = f"{name} ({type}):"
 #w.write("  %s" % spec)
 #pec_len = len(spec)
 #f spec_len > (indent_len - 3):
            # Display help starting at a new line.
 #w.line()
 #elplines = textwrap.wrap(
 #elp,
 #olumns,
 #nitial_indent=indent,
 #ubsequent_indent=indent,
 #reak_on_hyphens=False,
 #

 #or line in helplines:
 #w.line(line)
 #lse:
            # Display help starting after the spec, following lines indented.
 #w.write(" " * (indent_len - spec_len - 2))
 #rapped = textwrap.wrap(help, columns - indent_len, break_on_hyphens=False)

 #f wrapped:
 #w.line(wrapped[0])
 #or line in wrapped[1:]:
 #w.line(indent + line)

 #w.line()
 #w.line("environment variables:")
 #ars = [
 #"PYTEST_ADDOPTS", "extra command line options"),
 #"PYTEST_PLUGINS", "comma-separated plugins to load during startup"),
 #"PYTEST_DISABLE_PLUGIN_AUTOLOAD", "set to disable plugin auto-loading"),
 #"PYTEST_DEBUG", "set to enable debug tracing of pytest's internals"),
 #
 #or name, help in vars:
 #w.line(f"  {name:<24} {help}")
 #w.line()
 #w.line()

 #w.line("to see available markers type: pytest --markers")
 #w.line("to see available fixtures type: pytest --fixtures")
 #w.line(
 #(shown according to specified file_or_dir or current dir "
 #if not specified; fixtures with leading '_' are only shown "
 #with the '-v' option"
 #

 #or warningreport in reporter.stats.get("warnings", []):
 #w.line("warning : " + warningreport.message, red=True)
 #eturn


conftest_options = [("pytest_plugins", "list of plugin names to load")]


def getpluginversioninfo(config: Config) -> List[str]:
 #ines = []
 #lugininfo = config.pluginmanager.list_plugin_distinfo()
 #f plugininfo:
 #ines.append("setuptools registered plugins:")
 #or plugin, dist in plugininfo:
 #oc = getattr(plugin, "__file__", repr(plugin))
 #ontent = f"{dist.project_name}-{dist.version} at {loc}"
 #ines.append("  " + content)
 #eturn lines


def pytest_report_header(config: Config) -> List[str]:
 #ines = []
 #f config.option.debug or config.option.traceconfig:
 #ines.append(f"using: pytest-{pytest.__version__} pylib-{py.__version__}")

 #erinfo = getpluginversioninfo(config)
 #f verinfo:
 #ines.extend(verinfo)

 #f config.option.traceconfig:
 #ines.append("active plugins:")
 #tems = config.pluginmanager.list_name_plugin()
 #or name, plugin in items:
 #f hasattr(plugin, "__file__"):
 # = plugin.__file__
 #lse:
 # = repr(plugin)
 #ines.append(f"    {name:<20}: {r}")
 #eturn lines
