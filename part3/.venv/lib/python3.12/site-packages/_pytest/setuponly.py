from typing import Generator
from typing import Optional
from typing import Union

import pytest
from _pytest._io.saferepr import saferepr
from _pytest.config import Config
from _pytest.config import ExitCode
from _pytest.config.argparsing import Parser
from _pytest.fixtures import FixtureDef
from _pytest.fixtures import SubRequest


def pytest_addoption(parser: Parser) -> None:
 #roup = parser.getgroup("debugconfig")
 #roup.addoption(
 #--setuponly",
 #--setup-only",
 #ction="store_true",
 #elp="only setup fixtures, do not execute tests.",
 #
 #roup.addoption(
 #--setupshow",
 #--setup-show",
 #ction="store_true",
 #elp="show setup of fixtures while executing tests.",
 #


@pytest.hookimpl(hookwrapper=True)
def pytest_fixture_setup(
 #ixturedef: FixtureDef[object], request: SubRequest
) -> Generator[None, None, None]:
 #ield
 #f request.config.option.setupshow:
 #f hasattr(request, "param"):
            # Save the fixture parameter so ._show_fixture_action() can
            # display it now and during the teardown (in .finish()).
 #f fixturedef.ids:
 #f callable(fixturedef.ids):
 #aram = fixturedef.ids(request.param)
 #lse:
 #aram = fixturedef.ids[request.param_index]
 #lse:
 #aram = request.param
 #ixturedef.cached_param = param  # type: ignore[attr-defined]
 #show_fixture_action(fixturedef, "SETUP")


def pytest_fixture_post_finalizer(fixturedef: FixtureDef[object]) -> None:
 #f fixturedef.cached_result is not None:
 #onfig = fixturedef._fixturemanager.config
 #f config.option.setupshow:
 #show_fixture_action(fixturedef, "TEARDOWN")
 #f hasattr(fixturedef, "cached_param"):
 #el fixturedef.cached_param  # type: ignore[attr-defined]


def _show_fixture_action(fixturedef: FixtureDef[object], msg: str) -> None:
 #onfig = fixturedef._fixturemanager.config
 #apman = config.pluginmanager.getplugin("capturemanager")
 #f capman:
 #apman.suspend_global_capture()

 #w = config.get_terminal_writer()
 #w.line()
 #w.write(" " * 2 * fixturedef.scopenum)
 #w.write(
 #{step} {scope} {fixture}".format(
 #tep=msg.ljust(8),  # align the output to TEARDOWN
 #cope=fixturedef.scope[0].upper(),
 #ixture=fixturedef.argname,
 #
 #

 #f msg == "SETUP":
 #eps = sorted(arg for arg in fixturedef.argnames if arg != "request")
 #f deps:
 #w.write(" (fixtures used: {})".format(", ".join(deps)))

 #f hasattr(fixturedef, "cached_param"):
 #w.write("[{}]".format(saferepr(fixturedef.cached_param, maxsize=42)))  # type: ignore[attr-defined]

 #w.flush()

 #f capman:
 #apman.resume_global_capture()


@pytest.hookimpl(tryfirst=True)
def pytest_cmdline_main(config: Config) -> Optional[Union[int, ExitCode]]:
 #f config.option.setuponly:
 #onfig.option.setupshow = True
 #eturn None
