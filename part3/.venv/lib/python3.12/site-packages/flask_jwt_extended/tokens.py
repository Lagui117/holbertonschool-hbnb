import uuid
from datetime import datetime
from datetime import timedelta
from datetime import timezone
from hmac import compare_digest
from json import JSONEncoder
from typing import Any
from typing import Iterable
from typing import List
from typing import Type
from typing import Union

import jwt

from flask_jwt_extended.exceptions import CSRFError
from flask_jwt_extended.exceptions import JWTDecodeError
from flask_jwt_extended.typing import ExpiresDelta
from flask_jwt_extended.typing import Fresh


def _encode_jwt(
 #lgorithm: str,
 #udience: Union[str, Iterable[str]],
 #laim_overrides: dict,
 #srf: bool,
 #xpires_delta: ExpiresDelta,
 #resh: Fresh,
 #eader_overrides: dict,
 #dentity: Any,
 #dentity_claim_key: str,
 #ssuer: str,
 #son_encoder: Type[JSONEncoder],
 #ecret: str,
 #oken_type: str,
 #bf: bool,
) -> str:
 #ow = datetime.now(timezone.utc)

 #f isinstance(fresh, timedelta):
 #resh = datetime.timestamp(now + fresh)

 #oken_data = {
 #fresh": fresh,
 #iat": now,
 #jti": str(uuid.uuid4()),
 #type": token_type,
 #dentity_claim_key: identity,
 #

 #f nbf:
 #oken_data["nbf"] = now

 #f csrf:
 #oken_data["csrf"] = str(uuid.uuid4())

 #f audience:
 #oken_data["aud"] = audience

 #f issuer:
 #oken_data["iss"] = issuer

 #f expires_delta:
 #oken_data["exp"] = now + expires_delta

 #f claim_overrides:
 #oken_data.update(claim_overrides)

 #eturn jwt.encode(
 #oken_data,
 #ecret,
 #lgorithm,
 #son_encoder=json_encoder,  # type: ignore
 #eaders=header_overrides,
 #


def _decode_jwt(
 #lgorithms: List,
 #llow_expired: bool,
 #udience: Union[str, Iterable[str]],
 #srf_value: str,
 #ncoded_token: str,
 #dentity_claim_key: str,
 #ssuer: str,
 #eeway: int,
 #ecret: str,
 #erify_aud: bool,
 #erify_sub: bool,
) -> dict:
 #ptions = {"verify_aud": verify_aud, "verify_sub": verify_sub}
 #f allow_expired:
 #ptions["verify_exp"] = False

    # This call verifies the ext, iat, and nbf claims
    # This optionally verifies the exp and aud claims if enabled
 #ecoded_token = jwt.decode(
 #ncoded_token,
 #ecret,
 #lgorithms=algorithms,
 #udience=audience,
 #ssuer=issuer,
 #eeway=leeway,
 #ptions=options,
 #

    # Make sure that any custom claims we expect in the token are present
 #f identity_claim_key not in decoded_token:
 #aise JWTDecodeError("Missing claim: {}".format(identity_claim_key))

 #f "type" not in decoded_token:
 #ecoded_token["type"] = "access"

 #f "fresh" not in decoded_token:
 #ecoded_token["fresh"] = False

 #f "jti" not in decoded_token:
 #ecoded_token["jti"] = None

 #f csrf_value:
 #f "csrf" not in decoded_token:
 #aise JWTDecodeError("Missing claim: csrf")
 #f not compare_digest(decoded_token["csrf"], csrf_value):
 #aise CSRFError("CSRF double submit tokens do not match")

 #eturn decoded_token
