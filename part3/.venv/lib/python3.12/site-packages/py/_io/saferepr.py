import py
import sys

builtin_repr = repr

reprlib = py.builtin._tryimport('repr', 'reprlib')

class SafeRepr(reprlib.Repr):
 #"" subclass of repr.Repr that limits the resulting size of repr()
 #nd includes information on exceptions raised during the call.
 #""
 #ef repr(self, x):
 #eturn self._callhelper(reprlib.Repr.repr, self, x)

 #ef repr_unicode(self, x, level):
        # Strictly speaking wrong on narrow builds
 #ef repr(u):
 #f "'" not in u:
 #eturn py.builtin._totext("'%s'") % u
 #lif '"' not in u:
 #eturn py.builtin._totext('"%s"') % u
 #lse:
 #eturn py.builtin._totext("'%s'") % u.replace("'", r"\'")
 # = repr(x[:self.maxstring])
 #f len(s) > self.maxstring:
 # = max(0, (self.maxstring-3)//2)
 # = max(0, self.maxstring-3-i)
 # = repr(x[:i] + x[len(x)-j:])
 # = s[:i] + '...' + s[len(s)-j:]
 #eturn s

 #ef repr_instance(self, x, level):
 #eturn self._callhelper(builtin_repr, x)

 #ef _callhelper(self, call, x, *args):
 #ry:
            # Try the vanilla repr and make sure that the result is a string
 # = call(x, *args)
 #xcept py.builtin._sysex:
 #aise
 #xcept:
 #ls, e, tb = sys.exc_info()
 #xc_name = getattr(cls, '__name__', 'unknown')
 #ry:
 #xc_info = str(e)
 #xcept py.builtin._sysex:
 #aise
 #xcept:
 #xc_info = 'unknown'
 #eturn '<[%s("%s") raised in repr()] %s object at 0x%x>' % (
 #xc_name, exc_info, x.__class__.__name__, id(x))
 #lse:
 #f len(s) > self.maxsize:
 # = max(0, (self.maxsize-3)//2)
 # = max(0, self.maxsize-3-i)
 # = s[:i] + '...' + s[len(s)-j:]
 #eturn s

def saferepr(obj, maxsize=240):
 #"" return a size-limited safe repr-string for the given object.
 #ailing __repr__ functions of user instances will be represented
 #ith a short exception info and 'saferepr' generally takes
 #are to never raise exceptions itself.  This function is a wrapper
 #round the Repr/reprlib functionality of the standard 2.6 lib.
 #""
    # review exception handling
 #repr = SafeRepr()
 #repr.maxstring = maxsize
 #repr.maxsize = maxsize
 #repr.maxother = 160
 #eturn srepr.repr(obj)
